import{u as De,b as Fe,_ as re,c as We,a as Ne}from"./useAddGroupDialogStore-BaLBeNYg.js";import{_ as te}from"./Alert.vue_vue_type_script_setup_true_lang-f_OBNziH.js";import{aO as Y,c9 as se,aY as R,C as N,a4 as ue,cZ as $e,aX as de,y as Oe,G as t,T as C,L as Ue,ah as d,aL as xe,c_ as ne,ac as ie,ca as qe,cb as Re,ak as W,an as T,aE as p,av as n,aq as H,au as G,aG as D,aM as x,ay as c,ad as a,at as j,ax as q,aw as Q,aA as ce,aH as me,aT as pe,c$ as ve,al as He,aN as Ve,d0 as ee,aK as Ke,ao as je}from"./_virtual_wxt-plugins-DZjI-rY3.js";import{u as ae}from"./useMutation-RL6hm5Ow.js";import{p as fe}from"./immer-CwDZyRGJ.js";import{d as be,b as K}from"./tailwind-Be1c9XZh.js";import{C as Pe}from"./close-C3-Ad9eT.js";import{P as Qe}from"./plus-DKeKW68_.js";import{B as Ye}from"./bin-Fh_MlTbd.js";import{_ as Ze}from"./SfFavicon.vue_vue_type_script_setup_true_lang-xL4UatUz.js";import{u as ze}from"./options-CXlWlOx4.js";import{u as Xe}from"./useConfirmationStore-zY7by6Ys.js";import{u as he}from"./useChallengeStore-Cjyjd7K8.js";import{_ as _e}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{u as Je}from"./useGetNuclearTimerQuery-C0YoNoTy.js";import{u as et}from"./useAddTimerMutation-Dxk0NXmt.js";import{_ as tt}from"./HeaderItem-C3BiIv3w.js";import"./dialogWithOptionsStore-7Z99EG-6.js";import"./PlatformIcon.vue_vue_type_script_setup_true_lang-BkEQwird.js";function st(){const o=Y(),s=se();return ae({mutationFn:async({timerId:l,type:v,name:h,allowedTimeInMs:i,blocklist:g,isEnabled:E,brandIds:M})=>{const r=await o.timers.getTimerById(l);if(r){const $=r.timer,f=fe($,_=>{_.allowedTimeMs=i,_.blocklist=g,_.brandIds=M,_.name=h,_.isEnabled=E});v==N.Group&&f.isSynced&&await ue().addGenericUsageLimit($e(f)),await o.timers.upsertTimer(f)}},onSuccess:()=>{s.invalidateQueries({queryKey:[R.GetTimersForGroups]})}})}function ye(){const o=Y(),s=se();return ae({mutationFn:async({timerId:l,type:v})=>{v==N.Group?await ue().removeGenericUsageLimit(l):await o.timers.deleteTimer(l)},onSuccess:()=>{s.invalidateQueries({queryKey:[R.GetTimersForGroups]}),s.invalidateQueries({queryKey:[R.GetTimerForBlockAll]}),s.invalidateQueries({queryKey:[R.GetNuclearTimer]})}})}function nt(){return de({queryKey:[R.GetAppGroups],queryFn:()=>Oe(),refetchOnMount:!0,refetchOnReconnect:!0,refetchOnWindowFocus:!0})}function Te(o,s,l,v=!1){const h=o-s;let i=!0;if(l==0&&v)return alert(t("cannotSetTimeToZero")),!1;if(l>=C.Day)return alert(t("cannotSetMoreThan1440Mins")),!1;if(l<0)return alert(t("cannotSetTimeToZeroOrLess")),!1;if(s>=l&&(i=confirm(t("allSitesBlockedImmediately")),!i))return!1;if(l>o&&(h<180?(i=confirm(t("lessThanThreeMins")),i===!0&&(i=confirm(t("lessThanThreeMins2"))),i===!0&&(i=confirm(t("lessThanThreeMins3"))),i===!0&&(i=confirm(t("lessThanThreeMins4"))),i===!0&&(i=confirm(t("lessThanThreeMins5"))),i===!0&&(i=confirm(t("lessThanThreeMins6"))),i===!0&&(i=confirm(t("lessThanThreeMins7"))),i===!0&&(i=confirm(t("lessThanThreeMins8"))),i===!0&&(alert(t("tellingYourMom")),window.open(Ue.Procrastination))):(i=confirm(t("maybeYouShouldReconsider")),i===!0&&(i=confirm(t("onlyHurtingYourself"))),i===!0&&alert(t("meow")))),i===!0){let g=t("settingsUpdated");l<o&&(g=t("givingLessTime")+`

`+g),alert(g)}return i}function it(o){const s=d(()=>o.customLimitName==xe),l=d(()=>o.timeLeftMs<C.Second),v=d(()=>{const i=ne(o.dailyLimitDuration);return{hours:i.hours,minutes:i.minutes}}),h=d(()=>o.timeLeftMs<C.Second?1:o.timeLeftMs);return{isDefaultGroup:s,isTimeExpired:l,parsedAllowedTime:v,timeLeft:h}}const at=["data-testid"],ot={class:"flex flex-row p-3"},lt={class:"text-center min-w-24"},rt={key:0,class:"mt-6"},ut={class:"text-xs align-super ml-1"},dt={class:"grow m-auto"},ct={class:"p-3 join w-full items-center"},mt={class:"join-item bg-neutral padding-inherit"},pt={class:"w-full"},vt=["disabled","placeholder"],ft={class:"ps-3"},bt={class:"inline-block whitespace-nowrap"},ht={class:"join"},_t={class:"ml-3"},yt=["disabled"],Tt={class:"rounded-none mx-2"},gt=["disabled"],wt={class:"rounded-none mx-2"},kt=["disabled"],St={class:"p-3 border-t border-t-neutral"},At={class:"w-full flex justify-between items-center gap-4"},Gt={class:"text-sm grow font-bold whitespace-nowrap uppercase"},Mt={class:"w-full not-prose"},Et={class:"list-none",name:"blockedWebsites"},Bt={class:"flex justify-start items-center"},Lt=["onClick"],Ct={class:"inline-block"},It={key:1,class:"text-gray-500 ml-1"},Dt={key:1,class:"p-3 mt-3 border-t border-t-neutral"},Ft={class:"text-sm italic grow whitespace-nowrap"},Wt={name:"EditGroup"},Nt=ie({...Wt,props:{group:{},isNuclearOptionEnabled:{type:Boolean}},setup(o){const s=o,l=ze(),v=De(),{mutate:h}=st(),{mutate:i}=ye(),g=Fe(),{data:E}=nt(),{deviceGroup:M}=qe(Re()),{isDefaultGroup:r,parsedAllowedTime:$}=it(s.group),f=W(""),_=W(!1),L=W(0),B=W(0),S=W(),w=W([]),O=he(),F=d(()=>O.isShowLimitedSettings),Z=d(()=>{const e=ne(s.group.dailyLimitDuration);return f.value!=s.group.customLimitName||L.value!=e.hours||B.value!=e.minutes}),u=d(()=>s.group.dailyLimitDuration==0),y=d(()=>s.group.timeLeftMs<=C.Second),z=d(()=>!y.value&&!F.value),V=d(()=>(!y.value||u.value)&&!F.value),U=d(()=>!r.value&&!(y.value||s.group.dailyLimitDuration<C.Second)&&!F.value),we=d(()=>!s.isNuclearOptionEnabled&&(!y.value||u.value)&&!F.value),ke=d(()=>!(f.value==""||!Z.value)),X=d(()=>L.value*C.Hour+B.value*C.Minute),J=d(()=>{if(!S.value||!E.value)return[];let e=[];return w.value.forEach(m=>{const I=E.value.find(A=>A.brand_id==m);I&&e.push(I.name)}),S.value.forEach(m=>{e.push(m)}),e});function oe(e){return M.value?e.includes("/")||e.includes("*"):!1}const Se=d(()=>M.value?Object.keys(J.value).some(e=>oe(e)):!1);f.value=s.group.customLimitName,S.value=s.group.websiteUrls,w.value=s.group.brandIds??[],_.value=s.group.isEnabled,L.value=$.value.hours,B.value=$.value.minutes;function Ae(e){e.target.value>23&&(L.value=23)}function Ge(e){e.target.value>59&&(B.value=59)}async function Me(){if(s.group.customLimitName!=f.value&&g.isExist(f.value)){l.error(t("groupIsAlreadyUse"));return}Te(s.group.dailyLimitDuration,s.group.elapsedTimeMs,X.value,!1)&&(P(),l.success(t("groupSaved",s.group.customLimitName)))}function P(){h({timerId:s.group.id,type:N.Group,name:f.value,allowedTimeInMs:X.value,blocklist:S.value??[],isEnabled:_.value,brandIds:w.value??[]})}const Ee=Xe();function Be(){Ee.show({title:t("deleteBlockedGroup"),message:t("areYouSureDeleteGroup",s.group.customLimitName),positiveButtonText:t("deleteGroup"),destructive:!0,onClickPositive(){return i({timerId:s.group.id,type:N.Group}),!0},negativeButtonText:t("cancel")})}function Le(){v.show({addWebsites:Ie})}async function Ce(e){var m;S.value=(m=S.value)==null?void 0:m.filter(I=>!e.includes(I)),le(e),P(),me.track("DELETE_WEBSITE_FROM_BLOCKED_GROUP")}function Ie(e){var m;S.value=(m=S.value)==null?void 0:m.concat(e),le(),P()}function le(e=void 0){var I;if(J.value.length==0||!E.value){w.value=[];return}if(e){const A=E.value.find(k=>k.websites.includes(e)||k.name==e);A&&w.value.find(k=>k==A.brand_id)&&(w.value=w.value.filter(k=>k!=A.brand_id))}let m=[];(I=S.value)==null||I.forEach(A=>{const k=E.value.find(b=>b.websites.includes(A));k&&(m.push(A),w.value.find(b=>b==k.brand_id)||(w.value=w.value.concat(k.brand_id.toString())))}),m.forEach(A=>{S.value=S.value.filter(k=>k!=A)})}return(e,m)=>{const I=re,A=te,k=We;return p(),T("div",{class:"border border-neutral mt-4 rounded-md overflow-x-hidden",name:"blockedGroupElement","data-testid":f.value},[n("div",ot,[n("div",lt,[D(I,{"allowed-time":X.value,"elapsed-time":e.group.elapsedTimeMs,"data-testid":"maxTimeAllowedInHoursForAllView"},null,8,["allowed-time","elapsed-time"]),e.group.isSynced&&!F.value?(p(),T("div",rt,[x(n("input",{type:"checkbox",class:"toggle toggle-sm toggle-primary","onUpdate:modelValue":m[0]||(m[0]=b=>_.value=b),onChange:P},null,544),[[be,_.value]]),n("label",ut,c(_.value?("t"in e?e.t:a(t))("active"):("t"in e?e.t:a(t))("paused")),1)])):G("",!0)]),n("div",dt,[n("div",ct,[n("div",mt,[n("span",null,c(("t"in e?e.t:a(t))("name")),1)]),n("div",pt,[x(n("input",{disabled:a(r)||!z.value,"onUpdate:modelValue":m[1]||(m[1]=b=>f.value=b),class:"input input-bordered join-item w-full",placeholder:("t"in e?e.t:a(t))("groupName")},null,8,vt),[[K,f.value]])])]),n("div",ft,[n("p",bt,c(("t"in e?e.t:a(t))("maxTimeAllowedPerDay")),1),n("div",ht,[n("div",_t,[x(n("input",{type:"number",min:"0","onUpdate:modelValue":m[2]||(m[2]=b=>L.value=b),disabled:!V.value,onInput:Ae,"data-testid":"maxTimeAllowedInHoursForAllSites",class:"input input-bordered input-sm w-20"},null,40,yt),[[K,L.value]]),n("span",Tt,c(("t"in e?e.t:a(t))("hr")),1),x(n("input",{type:"number",min:"0",max:"59",disabled:!V.value,onInput:Ge,"onUpdate:modelValue":m[3]||(m[3]=b=>B.value=b),"data-testid":"maxTimeAllowedInMinutesForAllSites",class:"input input-bordered input-sm w-20"},null,40,gt),[[K,B.value]]),n("span",wt,c(("t"in e?e.t:a(t))("min")),1)])])]),y.value&&!u.value?(p(),H(A,{key:0,type:"error"},{default:j(()=>[q(c(("t"in e?e.t:a(t))("timeExpiredForGroup",[f.value])),1)]),_:1})):G("",!0),y.value&&u.value?(p(),H(A,{key:1,type:"error"},{default:j(()=>[q(c(("t"in e?e.t:a(t))("completelyBlockedGroup",[f.value])),1)]),_:1})):G("",!0),V.value?(p(),T("button",{key:2,class:"btn btn-primary btn-sm mt-3 ms-3","data-testid":"saveTimeForAllWebsitesBtn",onClick:Me,disabled:!ke.value},c(("t"in e?e.t:a(t))("saveChanges")),9,kt)):G("",!0),U.value?(p(),T("button",{key:3,onClick:Be,class:"btn btn-outline btn-error btn-sm mt-3 not-prose float-right uppercase"},[D(a(Ye),{class:"h-5 w-5 align-text-bottom"}),q(" "+c(("t"in e?e.t:a(t))("deleteGroup")),1)])):G("",!0)])]),a(r)?G("",!0):(p(),H(k,{key:0,"is-share":e.group.isSynced,"group-id":e.group.id},null,8,["is-share","group-id"])),n("div",St,[n("div",At,[n("p",Gt,c(("t"in e?e.t:a(t))("blockedWebsites")),1),n("button",{class:"btn btn-sm btn-primary btn-outline uppercase shrink flex-nowrap justify-start whitespace-nowrap overflow-hidden text-ellipsis",onClick:Le,"data-testid":"add-websites-btn"},[D(a(Qe),{class:"h-5 w-5 shrink-0 inline"}),q(" "+c(("t"in e?e.t:a(t))("addBlockedWebsites")),1)])]),n("div",Mt,[n("ul",Et,[(p(!0),T(Q,null,ce(J.value,b=>(p(),T("li",{key:b},[n("div",Bt,[we.value?(p(),T("button",{key:0,class:"btn btn-sm btn-ghost btn-circle mr-2",onClick:os=>Ce(b)},[D(a(Pe),{class:"h-4 w-4 cursor-pointer align-middle text-error inline-block","data-url":"website"})],8,Lt)):G("",!0),D(Ze,{"app-id":b,"app-name":b,size:24,class:"icon inline-block mr-2 align-middle w-6 h-6 my-1"},null,8,["app-id","app-name"]),n("p",Ct,c(b),1),e.group.isSynced&&oe(b)?(p(),T("p",It," * ")):G("",!0)])]))),128))])])]),Se.value?(p(),T("div",Dt,[n("p",Ft,c(("t"in e?e.t:a(t))("wildcardsPathsNotSupported")),1)])):G("",!0)],8,at)}}}),$t=_e(Nt,[["__scopeId","data-v-b3fdbe97"]]);function Ot(){const o=Y();return de({queryKey:[R.GetTimerForBlockAll],queryFn:()=>o.timers.getTimerById(N.BlockAll),refetchOnMount:!0,refetchOnReconnect:!0,refetchOnWindowFocus:!0})}function ge(){const{data:o}=Ot(),s=d(()=>o.value?o.value.timeLeftMs<C.Second?1:o.value.timeLeftMs:1),l=d(()=>o.value!=null),{state:v}=pe(ve),h=d(()=>o.value?o.value.timer.allowedTimeMs:v.value),i=d(()=>h.value-s.value),g=d(()=>s.value==0);return{isEnable:l,allowedTime:h,elapsedTime:i,remainingTime:s,isTimeExpired:g}}function Ut(){const o=Y(),s=se();return ae({mutationFn:async({timer:l,allowedTimeInMs:v})=>{const h=fe(l,i=>{i.allowedTimeMs=v});await o.timers.upsertTimer(h)},onSuccess:()=>{s.invalidateQueries({queryKey:[R.GetTimerForBlockAll]})}})}const xt={class:"cursor-pointer label justify-start mt-2",id:"blockAllWebsites"},qt=["disabled"],Rt={class:"label-text"},Ht={key:0,class:"flex flex-row p-3"},Vt={class:"pl-3 grow m-auto"},Kt={class:"inline-block whitespace-nowrap"},jt={class:"join"},Pt={class:"ml-3"},Qt=["disabled"],Yt={class:"rounded-none mx-2"},Zt=["disabled"],zt={class:"rounded-none mx-2"},Xt={name:"BlockAllWebsites"},Jt=ie({...Xt,setup(o){const{isEnable:s,allowedTime:l,elapsedTime:v,isTimeExpired:h}=ge(),{mutate:i}=ye(),{mutate:g}=Ut(),{state:E}=pe(ve),M=W(0),r=W(0);w(l.value),He(l,u=>{w(u)});const $=he(),f=d(()=>$.isShowLimitedSettings),_=d(()=>!(h.value||f.value));async function L(){s.value?i({timerId:ee,type:N.BlockAll}):(F(),me.track("BLOCK_ALL_WEBSITES"))}function B(u){u.target.value>23&&(M.value=23)}function S(u){u.target.value>59&&(r.value=59)}function w(u){const y=ne(u);M.value=y.hours,r.value=y.minutes}const O=d(()=>M.value*C.Hour+r.value*C.Minute);function F(){g({timer:{id:ee,name:ee,type:N.BlockAll,allowedTimeMs:O.value,isEnabled:!0,isSynced:!1},allowedTimeInMs:O.value}),E.value=O.value}async function Z(){Te(l.value,v.value,O.value,!0)?F():w(l.value)}return(u,y)=>{const z=re,V=te;return p(),T(Q,null,[n("label",xt,[x(n("input",{type:"checkbox",onClick:L,"onUpdate:modelValue":y[0]||(y[0]=U=>Ve(s)?s.value=U:null),disabled:f.value,"data-testid":"blockAllSites",class:"checkbox checkbox-sm checkbox-primary mr-2"},null,8,qt),[[be,a(s)]]),n("span",Rt,c(("t"in u?u.t:a(t))("blockAllwebsitesDescription")),1)]),a(s)?(p(),T("div",Ht,[D(z,{"allowed-time":O.value,"elapsed-time":a(v),"data-testid":"maxTimeAllowedInHoursForAllView"},null,8,["allowed-time","elapsed-time"]),n("div",Vt,[n("p",Kt,c(("t"in u?u.t:a(t))("maxTimeAllowedPerDay")),1),n("div",jt,[n("div",Pt,[x(n("input",{type:"number",min:"0","onUpdate:modelValue":y[1]||(y[1]=U=>M.value=U),disabled:!_.value,onInput:B,"data-testid":"maxTimeAllowedInHoursForAllSites",class:"input input-bordered input-sm w-20"},null,40,Qt),[[K,M.value]]),n("span",Yt,c(("t"in u?u.t:a(t))("hr")),1),x(n("input",{type:"number",min:"0",max:"59",disabled:!_.value,onInput:S,"onUpdate:modelValue":y[2]||(y[2]=U=>r.value=U),"data-testid":"maxTimeAllowedInMinutesForAllSites",class:"input input-bordered input-sm w-20"},null,40,Zt),[[K,r.value]]),n("span",zt,c(("t"in u?u.t:a(t))("min")),1)])]),a(h)?(p(),H(V,{key:0,type:"error"},{default:j(()=>[q(c(("t"in u?u.t:a(t))("timeExpiredCannotChangeUntilTomorrow")),1)]),_:1})):G("",!0),_.value?(p(),T("button",{key:1,class:"btn btn-primary btn-sm mt-3","data-testid":"saveTimeForAllWebsitesBtn",onClick:Z},c(("t"in u?u.t:a(t))("saveChanges")),1)):G("",!0)])])):G("",!0)],64)}}}),es={class:"flex flex-row justify-between mt-4 items-center"},ts={class:"font-bold text-lg"},ss=ie({__name:"BlockedSitesAndGroups",setup(o){const s=Ne(),{groups:l}=Ke(),{mutate:v}=et(),{data:h}=Je(),{isEnable:i}=ge(),g=d(()=>!!h.value);function E(){s.show({saveGroup:M})}function M(r){v({timer:{id:r.id,name:r.customLimitName??"",allowedTimeMs:r.dailyLimitDuration,type:N.Group,blocklist:r.websiteUrls,brandIds:r.brandIds,isEnabled:!0,isSynced:r.isSynced}})}return(r,$)=>{const f=Jt,_=te,L=$t;return p(),T(Q,null,[n("p",null,c(("t"in r?r.t:a(t))("blockedSitesHeader")),1),D(f),n("div",{class:je({"pointer-events-none opacity-50":a(i)})},[n("div",es,[n("p",ts,c(("t"in r?r.t:a(t))("groups")),1),n("button",{class:"btn btn-primary btn-sm",onClick:E},c(("t"in r?r.t:a(t))("addGroup")),1)]),a(g)?(p(),H(_,{key:0,type:"error"},{default:j(()=>[q(c(("t"in r?r.t:a(t))("cannotRemoveBlockedSiteDuringNuclearOption")),1)]),_:1})):G("",!0),(p(!0),T(Q,null,ce(a(l),B=>(p(),H(L,{key:B.id,group:B,"is-nuclear-option-enabled":a(g)},null,8,["group","is-nuclear-option-enabled"]))),128))],2)],64)}}}),ns={},is={class:"flex flex-col"};function as(o,s){const l=tt,v=ss;return p(),T("div",is,[D(l,null,{default:j(()=>[q(c(("t"in o?o.t:a(t))("blockedSites")),1)]),_:1}),D(v)])}const Gs=_e(ns,[["render",as]]);export{Gs as default};
