import{a1 as v,d2 as I,W as w,d3 as D,d4 as k,d5 as M,d6 as C,d7 as U,ac as F,ak as L,an as y,aE as _,aw as V,av as o,au as N,ay as r,ad as s,G as l,ax as f,d8 as O,aH as T,aG as h,at as R}from"./_virtual_wxt-plugins-DZjI-rY3.js";import{i as B}from"./migration-DuoToYlF.js";import{_ as $}from"./HeaderItem-C3BiIv3w.js";import{_ as j}from"./_plugin-vue_export-helper-DlAUqK2U.js";async function A(){function a(n,g){const E={mm:n.getMonth()+1,dd:n.getDate(),yyyy:n.getFullYear()};return g.replace(/yyyy|mm|dd/gi,b=>E[b].toString())}function c(n,g,E){const b=new Blob([n],{type:g}),S=document.createElement("a");S.download=E,S.href=window.URL.createObjectURL(b),S.style.display="none",document.body.appendChild(S),S.click()}const e=`StayFocusd_${a(new Date,"yyyy-mm-dd")}.json`;v("exportSettings","Export settings",e);const u=await I.getValue(),p=await w.snapshot("local"),t=await w.snapshot("sync"),m={};D.forEach(n=>{p[n]&&(m[n]=p[n])});const d={};u?k.forEach(n=>{p[n]&&(d[n]=p[n])}):k.forEach(n=>{t[n]&&(d[n]=t[n])});const i=M({LOCAL:m},{SYNC:d});c(JSON.stringify(i),"application/json",e)}const G=8192;async function J(a){const c=e=>new Promise((u,p)=>{const t=new FileReader;t.onloadend=m=>{var d;return u((d=m.target)==null?void 0:d.result)},t.onerror=p,v("importSettings","Importing settings",e),t.readAsText(e)});try{v("importSettings","Import settings",a);const e=await c(a),u=P(e),p=u.LOCAL,t={},m={};if(D.forEach(i=>{p[i]&&(t[i]=p[i])}),!await I.getValue()){const i=u.SYNC;let n=!1;k.forEach(g=>{i[g]&&(JSON.stringify(i[g]).length>G?(t[g]=i[g],n=!0):m[g]=i[g])}),n&&await I.setValue(!0)}for(const i of C)await i.removeMeta(["v"]);await w.restoreSnapshot("local",t),await w.restoreSnapshot("sync",m);for(const i of C)await i.migrate();return B(),!0}catch(e){return U("Save imported settings",e.message),!1}}function P(a){try{return JSON.parse(decodeURIComponent(a))}catch{return JSON.parse(a)}}const Y={key:0,class:"mt-3"},z={class:"text-success font-bold uppercase"},H={key:1,class:"mt-3"},Q={class:"text-error"},W={class:"mt-3"},q={class:"mt-3"},K=F({__name:"ImportSettings",setup(a){const c=L(),e=L(),u=`mailto:${O()}?subject=Error%20importing%20settings`;async function p(){var d;T.track("IMPORT_SETTINGS"),e.value=void 0;const t=(d=c.value)==null?void 0:d.files;if(!t||t.length===0)return alert(l("mustSelectSettingsFile")),!1;const m=await J(t[0]);e.value=m,m&&(c.value.value="",T.track("IMPORT_SETTINGS_SUCCESSFUL"))}return(t,m)=>(_(),y(V,null,[o("p",null,r(("t"in t?t.t:s(l))("importSettingsDescription")),1),o("input",{type:"file",ref_key:"fileInput",ref:c,class:"file-input file-input-bordered w-full mt-3",name:"settings",size:"40"},null,512),o("div",null,[o("button",{class:"btn btn-primary btn-sm mt-3 uppercase",onClick:p},r(("t"in t?t.t:s(l))("importSettings")),1)]),s(e)==!0?(_(),y("div",Y,[o("p",z,r(("t"in t?t.t:s(l))("done")),1)])):N("",!0),s(e)==!1?(_(),y("div",H,[o("p",Q,r(("t"in t?t.t:s(l))("problemImportingSettings")),1),o("p",W,[f(r(("t"in t?t.t:s(l))("importEmailSupport1"))+" ",1),o("a",{class:"link",href:u},r(("getSupportEmail"in t?t.getSupportEmail:s(O))()),1),f(" "+r(("t"in t?t.t:s(l))("importEmailSupport2")),1)])])):N("",!0),o("p",q,[o("small",null,[f(r(("t"in t?t.t:s(l))("importingSettingsOverwrite1"))+" ",1),o("b",null,r(("t"in t?t.t:s(l))("overwrite")),1),f(" "+r(("t"in t?t.t:s(l))("importingSettingsOverwrite2")),1)])])],64))}}),X=F({__name:"ExportSettings",setup(a){async function c(){await A()}return(e,u)=>(_(),y(V,null,[o("p",null,r(("t"in e?e.t:s(l))("exportSettingsDescription")),1),o("div",null,[o("button",{class:"btn btn-primary btn-sm mt-3 uppercase",onClick:c},r(("t"in e?e.t:s(l))("exportSettings")),1)])],64))}}),Z={},x={class:"flex flex-col"};function tt(a,c){const e=$,u=X,p=K;return _(),y("div",x,[h(e,null,{default:R(()=>[f(r(("t"in a?a.t:s(l))("exportSettings")),1)]),_:1}),h(u),c[0]||(c[0]=o("hr",{class:"mb-4 mt-7"},null,-1)),h(e,null,{default:R(()=>[f(r(("t"in a?a.t:s(l))("importSettings")),1)]),_:1}),h(p)])}const at=j(Z,[["render",tt]]);export{at as default};
